import { BabyAGI } from "langchain/experimental/babyagi";
import { MemoryVectorStore } from "langchain/vectorstores/memory";
import { OpenAIEmbeddings, OpenAI } from "@langchain/openai";
import { LLMChain } from "langchain/chains";
import { ChainTool } from "langchain/tools";
import { initializeAgentExecutorWithOptions } from "langchain/agents";
import { PromptTemplate } from "@langchain/core/prompts";
import { Tool } from "@langchain/core/tools";
import { SerpAPI } from "@langchain/community/tools/serpapi";

// 首先，我们创建一个自定义 agent，它将作为执行链。
const todoPrompt = PromptTemplate.fromTemplate(
  "你是一名规划者，擅长针对给定目标制定待办事项清单。请为该目标制定一份待办清单：{objective}"
);
const tools: Tool[] = [
  new SerpAPI(process.env.SERPAPI_API_KEY, {
    location: "San Francisco,California,United States",
    hl: "en",
    gl: "us",
  }),
  new ChainTool({
    name: "TODO",
    chain: new LLMChain({
      llm: new OpenAI({ temperature: 0 }),
      prompt: todoPrompt,
    }),
    description:
      "当你需要制定待办清单时非常有用。输入：需要为其创建待办清单的目标。输出：该目标的待办清单。请务必清楚说明目标！",
  }),
];
const agentExecutor = await initializeAgentExecutorWithOptions(
  tools,
  new OpenAI({ temperature: 0 }),
  {
    agentType: "zero-shot-react-description",
    agentArgs: {
      prefix: `你是一个基于以下目标执行单个任务的 AI：{objective}。请考虑这些已完成任务：{context}。`,
      suffix: `问题：{task}
{agent_scratchpad}`,
      inputVariables: ["objective", "task", "context", "agent_scratchpad"],
    },
  }
);

const vectorStore = new MemoryVectorStore(new OpenAIEmbeddings());

// 然后，我们创建一个 BabyAGI 实例。
const babyAGI = BabyAGI.fromLLM({
  llm: new OpenAI({ temperature: 0 }),
  executionChain: agentExecutor, // 一个 agent executor 本质上就是一条链
  vectorstore: vectorStore,
  maxIterations: 10,
});

await babyAGI.invoke({
  objective: "为今天的旧金山写一份简短的天气报告",
});
/*

*****任务清单*****

1: 制定一份待办清单

*****下一任务*****

1: 制定一份待办清单

*****任务结果*****

今天在旧金山，天气晴朗，气温华氏70度，微风，低湿度。预计未来几天天气相近。

*****任务清单*****

2: 查找旧金山未来几天的预报气温
3: 查找旧金山未来几天的预报风速
4: 查找旧金山未来几天的预报湿度
5: 创建一张图表，展示旧金山未来几天的预报温度、风速与湿度
6: 调研旧金山过去一周的平均气温
7: 调研旧金山过去一周的平均风速
8: 调研旧金山过去一周的平均湿度
9: 创建一张图表，展示旧金山过去一周的温度、风速与湿度

*****下一任务*****

2: 查找旧金山未来几天的预报气温

*****任务结果*****

旧金山未来几天的预报气温为 63°、65°、71°、73° 和 66°。

*****任务清单*****

3: 查找旧金山未来几天的预报风速
4: 查找旧金山未来几天的预报湿度
5: 创建一张图表，展示旧金山未来几天的预报温度、风速与湿度
6: 调研旧金山过去一周的平均气温
7: 调研旧金山过去一周的平均风速
8: 调研旧金山过去一周的平均湿度
9: 创建一张图表，展示旧金山过去一周的温度、风速与湿度
10: 对比旧金山未来几天的预报温度、风速与湿度和过去一周的平均温度、风速与湿度
11: 查找旧金山未来几天的降水预报
12: 调研旧金山过去一周的平均风向
13: 创建一张图表，展示旧金山过去一周的预报温度、风速与湿度
14: 对比旧金山未来几天的预报温度、风速与湿度与（缺失）

*****下一任务*****

3: 查找旧金山未来几天的预报风速

*****任务结果*****

西风10–20英里/小时，傍晚阵风可达35英里/小时。周二：晴。最高温在60多到70多华氏度。西风5–15英里/小时。

*****任务清单*****

4: 调研旧金山过去一周的平均降水
5: 调研旧金山过去一周的平均气温
6: 调研旧金山过去一周的平均风速
7: 调研旧金山过去一周的平均湿度
8: 调研旧金山过去一周的平均风向
9: 查找旧金山未来几天的预报温度、风速与湿度
10: 查找旧金山未来几天的降水预报
11: 创建一张图表，展示旧金山未来几天的预报温度、风速与湿度
12: 创建一张图表，展示旧金山过去一周的温度、风速与湿度
13: 创建一张图表，展示旧金山过去一个月的预报温度、风速与湿度
14: 对比旧金山未来几天的预报温度、风速与湿度与过去一周的平均温度、风速与湿度
15: 对比旧金山未来几天的预报温度、风速与湿度与（缺失）

*****下一任务*****

4: 调研旧金山过去一周的平均降水

*****任务结果*****

根据 Weather Underground，旧金山未来几天的降水预报包含 7 小时的雨雪以及 24 小时的降雨累积。

*****任务清单*****

5: 调研旧金山过去一个月的平均风速
6: 创建一张图表，展示旧金山过去一个月的预报温度、风速与湿度
7: 对比旧金山未来几天的预报温度、风速与湿度与过去一个月的平均温度、风速与湿度
8: 调研旧金山过去一个月的平均气温
9: 调研旧金山过去一个月的平均风向
10: 创建一张图表，展示旧金山未来几天的降水预报
11: 对比旧金山未来几天的降水预报与过去一周的平均降水
12: 查找旧金山未来几天的预报温度、风速与湿度
13: 查找旧金山未来几天的降水预报
14: 创建一张图表，展示旧金山过去一周的温度、风速与湿度
15: 创建一张图表，展示旧金山未来几天的预报温度、风速与湿度
16: 对比（缺失）

*****下一任务*****

5: 调研旧金山过去一个月的平均风速

*****任务结果*****

旧金山过去一个月的平均风速为 3.2 米/秒。

*****任务清单*****

6: 查找旧金山未来几天的预报温度、风速与湿度，
7: 查找旧金山未来几天的降水预报，
8: 创建一张图表，展示旧金山过去一周的温度、风速与湿度，
9: 创建一张图表，展示旧金山未来几天的预报温度、风速与湿度，
10: 对比旧金山未来几天的预报温度、风速与湿度与过去一个月的平均风速，
11: 调研旧金山过去一周的平均风速，
12: 创建一张图表，展示旧金山未来几天的降水预报，
13: 对比旧金山未来几天的降水预报与过去一个月的平均降水，
14: 调研旧金山过去一个月的平均气温，
15: 调研旧金山过去一个月的平均湿度，
16: 将旧金山未来几天的预报温度、风速与湿度与平均温度进行比较，

*****下一任务*****

6: 查找旧金山未来几天的预报温度、风速与湿度，

*****任务结果*****

旧金山未来几天的天气以晴为主，最高气温约 64。西风 7–12 英里/小时，下午增至 13–18 英里/小时，阵风最高可达 22 英里/小时。湿度约 50%。

*****任务清单*****

7: 查找旧金山未来几天的降水预报，
8: 创建一张图表，展示旧金山过去一周的温度、风速与湿度，
9: 创建一张图表，展示旧金山未来几天的预报温度、风速与湿度，
10: 对比旧金山未来几天的预报温度、风速与湿度与过去一个月的平均风速，
11: 调研旧金山过去一周的平均风速，
12: 创建一张图表，展示旧金山未来几天的降水预报，
13: 对比旧金山未来几天的降水预报与过去一个月的平均降水，
14: 调研旧金山过去一个月的平均气温，
15: 调研旧金山过去一个月的平均湿度，
16: 将旧金山未来几天的预报温度、风速与湿度与平均温度进行比较

*****下一任务*****

7: 查找旧金山未来几天的降水预报，

*****任务结果*****

根据 Weather Underground，旧金山未来几天的降水预报包括 7 小时的雨雪与 24 小时降雨累积，并提供降水的雷达与卫星图。

*****任务清单*****

8: 创建一张图表，展示旧金山过去一周的温度、风速与湿度，
9: 创建一张图表，展示旧金山未来几天的预报温度、风速与湿度，
10: 对比旧金山未来几天的预报温度、风速与湿度与过去一个月的平均风速，
11: 调研旧金山过去一周的平均风速，
12: 创建一张图表，展示旧金山未来几天的降水预报，
13: 对比旧金山未来几天的降水预报与过去一个月的平均降水，
14: 调研旧金山过去一个月的平均气温，
15: 调研旧金山过去一个月的平均湿度，
16: 将旧金山未来几天的预报温度、风速与湿度与平均温度进行比较

*****下一任务*****

8: 创建一张图表，展示旧金山过去一周的温度、风速与湿度，

*****任务结果*****

一张展示旧金山过去一周温度、风速与湿度的图表。

*****任务清单*****

9: 创建一张图表，展示旧金山未来几天的预报温度、风速与湿度
10: 对比旧金山未来几天的预报温度、风速与湿度与过去一个月的平均风速
11: 调研旧金山过去一周的平均风速
12: 创建一张图表，展示旧金山未来几天的降水预报
13: 对比旧金山未来几天的降水预报与过去一个月的平均降水
14: 调研旧金山过去一个月的平均气温
15: 调研旧金山过去一个月的平均湿度
16: 将旧金山未来几天的预报温度、风速与湿度与平均温度进行比较

*****下一任务*****

9: 创建一张图表，展示旧金山未来几天的预报温度、风速与湿度

*****任务结果*****

已创建的图表展示了旧金山未来几天的预报温度、风速与湿度。

*****任务清单*****

10: 调研旧金山过去一个月的平均风速
11: 对比旧金山未来几天的预报温度、风速与湿度与过去一个月的平均湿度
12: 创建一张图表，展示旧金山未来几天的降水预报
13: 对比旧金山未来几天的降水预报与过去一个月的平均降水
14: 调研旧金山过去一周的平均气温
15: 对比旧金山未来几天的预报温度、风速与湿度与过去一周的平均风速

*****下一任务*****

10: 调研旧金山过去一个月的平均风速

*****任务结果*****

旧金山过去一个月的平均风速为 2.7 米/秒。

[...]
*/
